<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>C&lt;DBIx::Hash2Table&gt; - Save a hash into a database table</title>
<link rev="made" href="mailto:" />
</head>

<body style="background-color: white">

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->

<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#synopsis">Synopsis</a></li>
	<li><a href="#description">Description</a></li>
	<li><a href="#distributions">Distributions</a></li>
	<li><a href="#constructor_and_initialization">Constructor and initialization</a></li>
	<li><a href="#method:_new(...)">Method: <code>new(...)</code></a></li>
	<li><a href="#method:_insert()">Method: <code>insert()</code></a></li>
	<li><a href="#required_modules">Required Modules</a></li>
	<li><a href="#changes">Changes</a></li>
	<li><a href="#faq">FAQ</a></li>
	<li><a href="#author">Author</a></li>
	<li><a href="#copyright">Copyright</a></li>
</ul>
<!-- INDEX END -->

<hr />
<p>
</p>
<h1><a name="name">NAME</a></h1>
<p><code>DBIx::Hash2Table</code> - Save a hash into a database table</p>
<p>
</p>
<hr />
<h1><a name="synopsis">Synopsis</a></h1>
<pre>
        #!/usr/bin/perl</pre>
<pre>
        my(%entity)     = create_a_hash(...);
        my($dbh)        = DBI -&gt; connect(...);
        my($table_name) = 'entity';</pre>
<pre>
        # Cope with MySQL-specific SQL.
        eval{$dbh -&gt; do(&quot;drop table if exists $table_name&quot;)};</pre>
<pre>
        # Cope with non-existant table.
        eval{$dbh -&gt; do(&quot;drop table $table_name&quot;)};</pre>
<pre>
        my($sql) = &quot;create table $table_name (id int, parent_id int, &quot; .
                                &quot;code char(5), name varchar(255) )&quot;;</pre>
<pre>
        $dbh -&gt; do($sql);</pre>
<pre>
        DBIx::Hash2Table -&gt; new
        (
                hash_ref   =&gt; \%entity,
                dbh        =&gt; $dbh,
                table_name =&gt; $table_name,
#               columns    =&gt; ['id', 'parent_id', 'name'] # or
#               columns    =&gt; ['id', 'parent_id', 'name', 'code']
                columns    =&gt; ['id', 'parent_id', 'name', '_url', 'code']
        ) -&gt; insert();</pre>
<p>
</p>
<hr />
<h1><a name="description">Description</a></h1>
<p><code>DBIx::Hash2Table</code> is a pure Perl module.</p>
<p>This module saves a hash into an existing database table of at least 3 columns.</p>
<p>I suggest you display the script examples/test-hash2table.pl in another window while reading the following.</p>
<p>In fact, you are <em>strongly</em> recommended to run the demo now, and examine the resultant database table, before reading
further. Then, move the comment # up from line 72 to 71 and run it again.</p>
<p>Hash keys normally point to hash refs. This nested structure is preserved when the data is written to the table.</p>
<p>That is, when a hash key points to a hash ref, the hash key is written to the table. The module keeps track of the
row in the table containing the parent of the 'current' hash key, and the parent's id (row number) is written to the
'current' row of the table.</p>
<p>Inside the hash ref you can have hash keys which are column names, or you can have hash keys which are 'normal'
hash keys.</p>
<p>If the nested hash key is a column name, then it should point to a non-ref, ie a number or a string. In that case,
you can optionally have the value it points to written to the table. In the example code, such a nested hash key is
called code, and at lines 71 .. 72 you can control whether or not the code values are written to the table.</p>
<p>If the nested hash key is not a column name, then it should point to a hash ref, and when its turn comes, it too
will be written to the table.</p>
<p>So, each row in the table will consist of these 3 columns, at least: id (row number), parent's id, and hash key.</p>
<p>In more detail, the 3 columns are:</p>
<ul>
<li></li>
An id column
<p>This column is for the unique id of the row containing the hash key.</p>
<p>You do not have to define this column of the table to be unique, or to be a database key, but that might be a Good Idea.</p>
<p><code>DBIx::Hash2Table</code> counts an integer up from 1, to generate the values for this column.</p>
<p></p>
<li></li>
The parent's id column
<p>This column is for the non-unique id of the row of the parent of the hash key.</p>
<p></p>
<li></li>
A name column
<p>This column is for the hash key itself.</p>
<p></p></ul>
<p>
</p>
<hr />
<h1><a name="distributions">Distributions</a></h1>
<p>This module is available both as a Unix-style distro (*.tgz) and an
ActiveState-style distro (*.ppd). The latter is shipped in a *.zip file.</p>
<p>See <a href="http://savage.net.au/Perl-modules.html">http://savage.net.au/Perl-modules.html</a> for details.</p>
<p>See <a href="http://savage.net.au/Perl-modules/html/installing-a-module.html">http://savage.net.au/Perl-modules/html/installing-a-module.html</a> for
help on unpacking and installing each type of distro.</p>
<p>
</p>
<hr />
<h1><a name="constructor_and_initialization">Constructor and initialization</a></h1>
<p><code>new(...)</code> returns a <code>DBIx::Hash2Table</code> object.</p>
<p>This is the class's contructor.</p>
<p>Parameters:</p>
<ul>
<li></li>
hash_ref
<p>A reference to the hash to be inserted in the table.</p>
<p></p>
<li></li>
dbh
<p>This is a database handle.</p>
<p></p>
<li></li>
table_name
<p>This is the name of the table to populate.</p>
<p></p>
<li></li>
columns
<p>This is an array ref of column names.</p>
<p>Warning: The order of entries in this array ref is of great significance. Of course, just because the column
names must be in this order does not mean the table itself must be declared with the columns in the same order.</p>
<ul>
<li></li>
Index 0
<p>This is the column name used for the id column.</p>
<p></p>
<li></li>
Index 1
<p>This is the column name used for the id of the parent of the hash key.</p>
<p>The root <code>key(s)</code> of the hash will have a parent id of 0.</p>
<p></p>
<li></li>
Index 2
<p>This is the column name used for the hash key itself.</p>
<p></p>
<li></li>
Indexes 3 .. N (optional)
<p>Any other column names must be hash keys which satisfy these conditions:</p>
<ul>
<li></li>
The column names 3 .. N are sorted alphabetically
<p>See below.</p>
<p></p>
<li></li>
It's a column name
<p>The hash key is actually the name of a column in the table.</p>
<p></p>
<li></li>
It's a child
<p>The hash key is a child of the 'current' hash key.</p>
<p></p>
<li></li>
It's value is a constant
<p>It's value is a non-ref, ie a number or a string.</p>
<p></p>
<li></li>
Save me!
<p>You want the hash key's value to be written to the 'current' row of the table.</p>
<p>In other words, even though this hash key (which is a column name!) is a child of the 'current' hash key, the
value pointed to by this hash key is written to the same row has the 'current' hash key.</p>
<p></p></ul>
<p>The program examples/test-hash2table.pl shows exactly what this means.</p>
<p>Warning: The names of these columns 3 .. N must be sorted alphabetically. That's the only way the module can know how
to bind the values associated with these columns into their correct places in the SQL insert statement.</p>
</ul>
</ul>
<p>
</p>
<hr />
<h1><a name="method:_new(...)">Method: <code>new(...)</code></a></h1>
<p>Returns an object of type <code>DBIx::Hash2Table</code>.</p>
<p>See above, in the section called 'Constructor and initialization'.</p>
<p>
</p>
<hr />
<h1><a name="method:_insert()">Method: <code>insert()</code></a></h1>
<p>Returns nothing.</p>
<p>Calling <code>insert()</code> actually executes the SQL insert statement, and recursively writes all hash keys to the table.</p>
<p>
</p>
<hr />
<h1><a name="required_modules">Required Modules</a></h1>
<p>DBI, since you must provide a database handle.</p>
<p>
</p>
<hr />
<h1><a name="changes">Changes</a></h1>
<p>See Changes.txt.</p>
<p>
</p>
<hr />
<h1><a name="faq">FAQ</a></h1>
<p>Q: What is the point of this module?</p>
<p>A: To be able to save a hash to permanent storage via a database rather than via a file.</p>
<p>Q: Can your other module <code>DBIx::Table2Hash</code> reconstruct a hash written by this module?</p>
<p>A: No. Sorry. Perhaps one day.</p>
<p>
</p>
<hr />
<h1><a name="author">Author</a></h1>
<p><code>DBIx::Hash2Table</code> was written by Ron Savage <em>&lt;<a href="mailto:ron@savage.net.au">ron@savage.net.au</a>&gt;</em> in 2003.</p>
<p>Home page: <a href="http://savage.net.au/index.html">http://savage.net.au/index.html</a></p>
<p>
</p>
<hr />
<h1><a name="copyright">Copyright</a></h1>
<p>Australian copyright (c) 2003, Ron Savage. All rights reserved.</p>
<pre>
        All Programs of mine are 'OSI Certified Open Source Software';
        you can redistribute them and/or modify them under the terms of
        The Artistic License, a copy of which is available at:
        <a href="http://www.opensource.org/licenses/index.html">http://www.opensource.org/licenses/index.html</a></pre>

</body>

</html>
